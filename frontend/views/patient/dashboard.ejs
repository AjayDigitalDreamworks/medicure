<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MediCure - Patient Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="/css/dash-patient.css" rel="stylesheet" />
    <link href="/css/login-style.css" rel="stylesheet" />
</head>
<body>
<div class="d-flex">
    <!-- Sidebar -->
    <nav class="sidebar bg-light">
        <div class="sidebar-header p-3">
            <h4 class="text-primary fw-bold">
                <i class="bi bi-heart-pulse"></i> MediCure
            </h4>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="/">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/patient/bookappointments">
                    <i class="bi bi-calendar-check"></i> Book Appointment
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/patient/admission/list">
                    <i class="bi bi-file-earmark-medical"></i> View Medical Records
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/patient/admission">
                    <i class="bi bi-person-plus"></i> Admit Records
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content flex-grow-1">
        <div class="top-bar bg-white border-bottom p-3 d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Dashboard</h5>
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-light"><i class="bi bi-person-circle fs-4 text-muted"></i></button>
                <a class="dropdown-item" href="/api/auth/logout">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </a>
            </div>
        </div>

        <div class="content-area p-4">

            <!-- Patient Overview -->
            <div class="patient-overview-section mb-4">
                <div class="card p-4">
                    <div class="d-flex justify-content-between align-items-start mb-4">
                        <div>
                            <h3 class="patient-title">Patient Overview</h3>
                            <div class="patient-info">
                                <div class="patient-detail">
                                    <span class="label">Date of Birth:</span>
                                    <span class="value dob"></span>
                                </div>
                                <div class="patient-detail">
                                    <span class="label">Allergies:</span>
                                    <span class="value allergies"></span>
                                </div>
                            </div>
                        </div>
                        <div class="patient-id">
                            <h5 class="patient-name-id"></h5>
                        </div>
                    </div>
                    
                    <div class="medical-info-row">
                        <div class="diagnoses">
                            <h6>Diagnoses:</h6>
                            <div class="diagnosis-list"></div>
                        </div>
                        <div class="medications">
                            <h6>Active Medications:</h6>
                            <div class="medication-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lab Results -->
            <div class="lab-results-section mb-4">
                <div class="card p-4">
                    <h3 class="section-title">Latest Laboratory Results</h3>
                    <div class="table-responsive">
                        <table class="table lab-table">
                            <thead>
                                <tr>
                                    <th>Test Name</th>
                                    <th>Result</th>
                                    <th>Unit</th>
                                    <th>Reference Range</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Imaging Reports -->
            <div class="imaging-reports-section mb-4">
                <div class="card p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 class="section-title">Recent Imaging Reports</h3>
                        <button class="btn btn-success export-btn">EXPORT REPORT</button>
                    </div>
                    <div class="table-responsive">
                        <table class="table imaging-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Summary</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="dashboard-grid">
                
                <!-- Upcoming Appointment -->
                <div class="card p-3">
                    <h3 class="card-title">Upcoming Appointment</h3>
                    <div class="appointment-status"></div>
                    <div class="appointment-date"></div>
                    <div class="detail-row">
                        <span class="label">Doctor:</span>
                        <span class="value doctor"></span>
                    </div>
                    <div class="detail-row">
                        <span class="label">Department:</span>
                        <span class="value department"></span>
                    </div>
                </div>

                <!-- Admissions -->
                <div class="card p-3">
                    <h3 class="card-title">My Admissions</h3>
                    <ul class="list-group admissions-list"></ul>
                </div>

                <!-- Notifications -->
                <div class="card p-3">
                    <h3 class="card-title">Notifications</h3>
                    <ul class="list-group notifications-list"></ul>
                </div>

                <!-- Queue Position -->
                <div class="card p-3">
                    <h3 class="card-title">Queue Position</h3>
                    <p>Your current position in queue: <strong class="queue-position"></strong></p>
                </div>

                 <!-- Bed Assignment -->
                <div class="card bed-card p-3">
                    <h3 class="card-title">Bed Assignment</h3>
                    <div class="bed-info">
                        <div class="bed-detail">
                            <span class="bed-label">Ward:</span>
                            <span class="bed-value ward"></span>
                        </div>
                        <div class="bed-detail">
                            <span class="bed-label">Room:</span>
                            <span class="bed-value room"></span>
                        </div>
                        <div class="bed-detail">
                            <span class="bed-label">Bed No:</span>
                            <span class="bed-value bedno"></span>
                        </div>
                        <div class="bed-detail">
                            <span class="bed-label">Attending Physician:</span>
                            <span class="bed-value physician"></span>
                        </div>
                    </div>
                    <button class="btn btn-secondary">View Ward Map</button>
                </div>

                 <!-- Quick Actions -->
                <div class="card actions-card p-3">
                    <h3 class="card-title">Quick Actions</h3>
                    <div class="action-buttons">
                        <a href="#appointments" class="btn btn-primary full-width">Book New Appointment</a>
                        <button class="btn btn-secondary full-width">View Medical Records</button>
                        <button class="btn btn-secondary full-width">Contact Support</button>
                    </div>
                </div>

            </div>
        </div>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    try {
        const patientId = "P1001"; // Normally from login session
        const res = await axios.get(`http://localhost:5000/api/patient/${patientId}`);
        const data = res.data;

        // Patient Overview
        document.querySelector(".patient-name-id").innerText = `${data.name} (${data.patientId})`;
        document.querySelector(".dob").innerText = new Date(data.dob).toDateString();
        document.querySelector(".allergies").innerText = data.allergies.join(", ");

        // Diagnoses
        const diagContainer = document.querySelector(".diagnosis-list");
        diagContainer.innerHTML = "";
        data.diagnoses.forEach(d => {
            diagContainer.innerHTML += `<span class="diagnosis-tag">${d}</span>`;
        });

        // Medications
        const medContainer = document.querySelector(".medication-list");
        medContainer.innerHTML = "";
        data.medications.forEach(m => {
            medContainer.innerHTML += `<span class="medication-tag">${m}</span>`;
        });

        // Lab Results
        const labTable = document.querySelector(".lab-table tbody");
        labTable.innerHTML = "";
        data.labResults.forEach(l => {
            labTable.innerHTML += `
                <tr>
                    <td>${l.testName}</td>
                    <td>${l.result}</td>
                    <td>${l.unit}</td>
                    <td>${l.referenceRange}</td>
                    <td><span class="status-badge ${l.status.toLowerCase()}">${l.status}</span></td>
                </tr>
            `;
        });

        // Imaging Reports
        const imagingTable = document.querySelector(".imaging-table tbody");
        imagingTable.innerHTML = "";
        data.imagingReports.forEach(r => {
            imagingTable.innerHTML += `
                <tr>
                    <td>${new Date(r.date).toISOString().split("T")[0]}</td>
                    <td>${r.type}</td>
                    <td>${r.summary}</td>
                    <td><span class="status-badge ${r.status.toLowerCase()}">${r.status}</span></td>
                </tr>
            `;
        });

        // Upcoming Appointment
        if (data.appointments.length > 0) {
            const appt = data.appointments[0];
            document.querySelector(".appointment-status").innerText = appt.status;
            document.querySelector(".appointment-date").innerText = new Date(appt.date).toLocaleString();
            document.querySelector(".doctor").innerText = appt.doctor;
            document.querySelector(".department").innerText = appt.department;
        }

        // Admissions
        const admissionsList = document.querySelector(".admissions-list");
        admissionsList.innerHTML = "";
        data.admissions.forEach(a => {
            admissionsList.innerHTML += `<li class="list-group-item"><strong>${a.department}</strong> - ${new Date(a.date).toLocaleString()}</li>`;
        });

        // Notifications
        const notifList = document.querySelector(".notifications-list");
        notifList.innerHTML = "";
        data.notifications.forEach(n => {
            notifList.innerHTML += `<li class="list-group-item">${n}</li>`;
        });

        // Queue Position
        document.querySelector(".queue-position").innerText = data.queuePosition;

        // Bed Assignment
        document.querySelector(".ward").innerText = data.bedAssignment.ward;
        document.querySelector(".room").innerText = data.bedAssignment.room;
        document.querySelector(".bedno").innerText = data.bedAssignment.bedNo;
        document.querySelector(".physician").innerText = data.bedAssignment.physician;

    } catch (err) {
        console.error("Error fetching patient data:", err);
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
